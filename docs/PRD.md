# 커피 주문 앱

## 1.1 프로젝트명
커피 주문 앱

### 1.2 프로젝트 목적
사용자가 커피 메뉴를 주문하고, 관리자가 주문을 관리할 수 있는 간단한 풀스택 웹 앱

### 1.3 개발 범위
- 주문하기 화면(메뉴 선택 및 장바구니 기능)
- 관리자 화면(재고 관리 및 주문 상태 관리)
- 데이터를 생성/조회/수정/삭제할 수 있는 기능

## 2. 기술 스택
- 프런트엔드 : HTML, CSS, 리액트, 자바스크립트
- 백엔드 : Node.Js, Express
- 데이터베이스 : PostgreSQL

## 3. 기본 사항
- 프런트엔드와 백엔드를 따로 개발
- 기본적인 웹 기술만 사용
- 학습 목적이므로 사용자 인증이나 결제 기능은 제외
- 메뉴는 커피 메뉴만 있음

# 주문하기 화면 PRD

## 목적
- 사용자가 메뉴를 보고 옵션을 선택해 장바구니에 담고, 최종적으로 주문을 생성할 수 있도록 하는 직관적이고 오류가 적은 UI 설계.

## 대상 사용자
- 일반 고객(비로그인 가능). 빠르게 메뉴를 선택해 픽업/테이크아웃 주문을 하는 사용자를 우선 고려.

## 주요 목표(성공 기준)
- 메뉴 선택 → 옵션(샷/시럽 등) 선택 → 장바구니 담기 과정이 3단계 이내로 완료.
- 주문 완료 전 총 금액과 항목별 가격이 명확히 노출.
- 모바일/데스크탑 모두에서 가독성 유지.

## 화면 구성(와이어프레임 기준)
1. 헤더
   - 로고(COZY), 화면 전환 버튼(주문하기, 관리자)
2. 메뉴 그리드
   - 카드: 이미지, 이름(ICE/HOT 표기), 가격, 간단 설명, 옵션 체크박스(추가금액 표기), 담기 버튼
3. 장바구니 패널(하단)
   - 선택 항목 목록(옵션 포함), 각 항목 수량, 항목별 소계, 전체 합계, 주문하기 버튼
4. 상태 표시/피드백
   - 담기 성공 토스트, 옵션 미선택 경고, 재고 부족 메시지

## 사용자 흐름
1. 메뉴 스크롤/탐색 → 카드에서 옵션 선택 → 담기 버튼 클릭  
2. 장바구니에서 수량 조절 또는 삭제 → 총금액 확인  
3. 주문하기 버튼 클릭 → 주문 요약 확인(모달 또는 새 화면) → 주문 생성(백엔드 호출) → 성공 알림 및 장바구니 초기화

## 상호작용 및 동작 규칙
- 옵션은 카드 내에서 체크박스 형태. 선택 시 실시간으로 카드 내 표시 금액은 변하지 않음(장바구니에서 최종 금액 반영).
- 담기 버튼 클릭 시 해당 메뉴 + 선택 옵션을 하나의 라인 아이템으로 장바구니에 추가(같은 옵션 조합이면 수량 합산).
- 수량 변경(+-)은 장바구니에서 즉시 총합 재계산.
- 주문하기 전 필수 옵션 존재 시(예: 온도 선택 필수) 담기 또는 주문 제한과 함께 안내 메시지 표시.
- 네트워크 오류 시 실패 모달/토스트와 재시도 버튼 제공.

## 데이터 / API 요구사항
- GET /api/menus -> id, name, description, price, imageUrl, options[{id, name, priceDelta, required?}], stock  
- POST /api/orders -> {items:[{menuId, optionIds[], quantity}], total} -> returns orderId, status  
- GET /api/menus/:id 재고 확인(담기 시 최신 재고 확인 권장)  
- 응답 실패(4xx/5xx) 처리 규칙 명시

## 상태관리
- 로컬 상태: 현재 화면의 선택 옵션(카드별), 장바구니(아이템 배열), UI 상태(토스트/모달)  
- 전역 상태: 장바구니는 세션 유지(리로드 시 로컬스토리지에 임시 저장)  
- 낙관적 업데이트: 담기 동작은 성공 가정 UI 업데이트 후 API 응답에 따라 롤백 가능

## 유효성 및 에러 처리
- 수량은 1 이상 정수만 허용.  
- 옵션 가격합계 및 총액 계산은 프론트에서 항상 재계산(백엔드 합계와 불일치 시 서버 응답 우선 후 UI 동기화).  
- 장바구니 담기/주문 시 재고 부족 응답 수신하면 해당 항목 사용자에게 알림 및 자동 수량 조정 제안.

## 접근성(필수)
- 버튼/입력에 대해 적절한 aria-label 제공.  
- 이미지에 대체 텍스트 제공.  
- 키보드 네비게이션(탭 순서) 보장.  
- 색 대비 기준 충족(텍스트 vs 배경).

## 반응형 규칙
- 데스크탑: 카드 3열(와이어프레임과 동일).  
- 태블릿: 2열, 모바일: 1열(장바구니는 플로팅 바 또는 풀스크린으로 전환).  
- 장바구니는 모바일에서 접이식(스크롤 우선)으로 표시, 주문하기 CTA는 항상 화면 하단에 고정.

## 측정 지표(추후 개선용)
- 담기 클릭률(메뉴별)  
- 장바구니 이탈률(장바구니 진입 후 일정 시간 내 주문 미완료)  
- 오류 발생률(주문 실패/재고 실패)

## 비고 / 제약
- 인증 및 결제는 학습 목적상 제외(주문 생성은 로컬/백엔드에 주문 상태만 생성).  
- 다국어 미지원(초기에는 한국어 고정).  
- 이미지/미디어는 로컬 또는 CDN을 사용하되 퍼포먼스 최적화(지연 로드) 권장.

# 관리자 화면 PRD

## 목적
- 관리자가 주문 현황과 재고를 실시간으로 확인·조작하고, 주문을 접수·제조 상태로 변경할 수 있도록 하는 운영용 UI 설계.

## 대상 사용자
- 매장 관리자(직원). 빠른 상황 파악과 최소한의 클릭으로 작업을 처리하는 사용자를 우선 고려.

## 주요 목표(성공 기준)
- 관리자 대시보드에서 총 주문/접수/제조중/제조완료 수치를 한눈에 확인.
- 재고 증감(+)/- 버튼으로 즉시 재고 업데이트 가능.
- 주문 목록에서 주문 접수/제조 시작/완료 등의 상태 전환이 1클릭으로 가능.
- 상태 변경 시 실수 방지를 위한 최소한의 확인 또는 취소 기능 제공.

## 화면 구성(와이어프레임 기준)
1. 헤더
   - 로고, 화면 전환 버튼(주문하기, 관리자)
2. 관리자 대시보드(상단)
   - 총 주문 수 / 주문 접수 수 / 제조 중 / 제조 완료 등 요약 배지
3. 재고 현황 섹션
   - 메뉴별 카드: 이름, 현재 재고 수량, + / - 버튼(인라인 수정)
   - 재고 변경 시 실시간 반영 및 변경 로그(간단)
4. 주문 현황 섹션
   - 주문 목록(시간, 아이템, 수량, 금액, 상태 버튼)
   - 각 주문 행에 상태 전환 버튼(예: 주문 접수, 제조 시작, 제조 완료)
   - 상태 변경 시 토스트/모달 피드백
5. 기타
   - 필터(상태별: 대기/접수/제조중/완료), 검색(주문 ID 또는 아이템)
   - 페이징 또는 무한 스크롤

## 사용자 흐름
1. 관리자 로그인(생략 가능) → 대시보드 확인 → 재고 부족 항목 발견 시 + 버튼으로 수량 증가
2. 새 주문 도착 → 주문 목록에서 '주문 접수' 클릭 → 상태가 변경되고 제조 섹션으로 이동(필요 시 알림)
3. 제조 완료 시 '제조 완료' 클릭 → 주문 리스트에서 완료 처리(필요 시 출력/알림)

## 상호작용 및 동작 규칙
- 재고 버튼 클릭은 즉시 UI에 반영(낙관적 업데이트). 서버 실패 시 롤백 및 오류 토스트.
- 같은 메뉴에 대해 연속 변경 시 배치 업데이트(성능 고려).
- 주문 상태 전환은 순차적(대기 → 접수 → 제조중 → 완료). 비정상 전환 시 경고.
- 상태 변경 버튼은 현재 상태에 맞는 액션만 활성화.

## 데이터 / API 요구사항
- GET /api/admin/summary -> {total, received, inProgress, completed}
- GET /api/menus -> id, name, stock
- PATCH /api/menus/:id/stock -> {delta} 또는 {stock}
- GET /api/orders?status=&page= -> list with {id, createdAt, items[{name, options, qty}], total, status}
- PATCH /api/orders/:id/status -> {status}
- 변경 이력 및 오류 응답(4xx/5xx) 처리 규칙

## 상태관리
- 전역 상태: 대시보드 요약, 재고 목록, 주문 목록(필터/페이지 상태)
- 실시간성: 폴링 또는 WebSocket으로 주문/재고 업데이트 수신 권장
- 낙관적 업데이트: 재고/주문 상태 변경은 UI 우선 반영 후 서버 응답 동기화

## 유효성 및 에러 처리
- 재고는 음수 불가(서버/클라이언트 검증).
- 동시성 문제: 재고 변경 충돌 시 서버 우선 정책(최신 재고 수신 후 UI 동기화 및 사용자 알림).
- 주문 상태 변경 실패 시 재시도 또는 롤백 안내.

## 접근성
- 버튼에 명확한 레이블과 aria-속성 제공.
- 키보드로 재고/주문 항목 조작 가능.
- 상태 배지에 충분한 색 대비와 텍스트 대체 설명.

## 반응형 규칙
- 데스크탑: 재고 카드 가로 정렬, 주문 리스트 상세 열 표시.
- 태블릿/모바일: 카드/리스트 단순화(요약 표시), 상태 변경 버튼은 숨김 없이 접근 가능하도록 재배치.

## 측정 지표
- 평균 주문 처리 시간(접수 → 제조 완료)
- 재고 수동 수정 빈도(아이템별)
- 상태 변경 실패율 및 재시도율

## 비고 / 제약
- 관리자 권한 및 인증은 최소 구현 또는 로컬 보호(학습 목적).
- 실시간 알림 구현은 우선 폴링으로 시작 가능, 이후 WebSocket 고려.
- 모든 주요 변경은 서버 로그에 기록되어야 함(감사 추적).

# 백엔드 PRD

## 목적
- 커피 주문 앱의 프런트엔드에 필요한 데이터를 제공하고, 주문 및 재고와 관련된 비즈니스 로직을 처리하는 안정적인 API 서버를 구축합니다.

## 주요 기능
- 메뉴 정보 관리 및 제공
- 주문 접수 및 상태 관리
- 재고 수량 관리 및 동기화

## 1. 데이터 모델 (Database Schema)
- 데이터베이스는 PostgreSQL을 사용합니다.
- 각 테이블의 관계를 명확히 하여 데이터 무결성을 보장합니다.

### 1.1 `menus` 테이블
- 커피 메뉴에 대한 정보를 저장합니다.
- **컬럼:**
  - `id` (PK, SERIAL): 메뉴 고유 ID
  - `name` (VARCHAR(255), NOT NULL): 커피 이름 (예: '아메리카노(ICE)')
  - `description` (TEXT): 메뉴 설명
  - `price` (INTEGER, NOT NULL): 가격 (원 단위)
  - `image_url` (VARCHAR(255)): 메뉴 이미지 URL
  - `stock` (INTEGER, NOT NULL, DEFAULT 0): 재고 수량

### 1.2 `options` 테이블
- 메뉴에 추가할 수 있는 옵션 정보를 저장합니다.
- **컬럼:**
  - `id` (PK, SERIAL): 옵션 고유 ID
  - `name` (VARCHAR(255), NOT NULL): 옵션 이름 (예: '샷 추가', '시럽 추가')
  - `price` (INTEGER, NOT NULL, DEFAULT 0): 옵션 추가 가격

### 1.3 `menu_options` 테이블 (Junction Table)
- 메뉴와 옵션 간의 다대다(N:M) 관계를 설정합니다.
- **컬럼:**
  - `menu_id` (FK, INTEGER): `menus` 테이블의 ID 참조
  - `option_id` (FK, INTEGER): `options` 테이블의 ID 참조

### 1.4 `orders` 테이블
- 사용자의 주문 정보를 저장합니다.
- **컬럼:**
  - `id` (PK, SERIAL): 주문 고유 ID
  - `created_at` (TIMESTAMP, DEFAULT NOW()): 주문 생성 일시
  - `status` (VARCHAR(50), NOT NULL, DEFAULT '주문 접수'): 주문 상태 ('주문 접수', '제조 중', '완료')
  - `total_price` (INTEGER, NOT NULL): 주문 총액

### 1.5 `order_items` 테이블
- 특정 주문에 어떤 메뉴와 옵션이 포함되었는지 저장합니다.
- **컬럼:**
  - `id` (PK, SERIAL): 주문 항목 고유 ID
  - `order_id` (FK, INTEGER): `orders` 테이블의 ID 참조
  - `menu_id` (FK, INTEGER): `menus` 테이블의 ID 참조
  - `quantity` (INTEGER, NOT NULL): 주문 수량
  - `price_per_item` (INTEGER, NOT NULL): 항목별 단가 (옵션 포함)

### 1.6 `order_item_options` 테이블 (Junction Table)
- 특정 주문 항목에 어떤 옵션이 적용되었는지 저장합니다.
- **컬럼:**
  - `order_item_id` (FK, INTEGER): `order_items` 테이블의 ID 참조
  - `option_id` (FK, INTEGER): `options` 테이블의 ID 참조

## 2. API 설계 (API Endpoints)
- API는 RESTful 원칙을 따르며, 모든 응답은 JSON 형식을 사용합니다.
- 프런트엔드 PRD에 명시된 API 요구사항과 일관성을 유지합니다.

### 2.1 메뉴 API
- **`GET /api/menus`**
  - **설명:** 프런트엔드에 표시할 모든 메뉴 목록을 조회합니다. 재고(`stock`) 정보는 관리자만 접근 가능해야 하지만, 초기 버전에서는 모든 정보를 함께 제공합니다.
  - **응답 (200 OK):**
    ```json
    [
      {
        "id": 1,
        "name": "아메리카노(ICE)",
        "description": "시원하고 깔끔한...",
        "price": 4000,
        "imageUrl": "...",
        "stock": 100,
        "options": [
          { "id": 1, "name": "샷 추가", "price": 500 },
          { "id": 2, "name": "시럽 추가", "price": 0 }
        ]
      }
    ]
    ```

### 2.2 주문 API
- **`POST /api/orders`**
  - **설명:** 신규 주문을 생성합니다. 주문 생성 시 관련된 메뉴의 재고를 차감해야 합니다. 이 과정은 트랜잭션(Transaction)으로 처리하여 데이터 일관성을 보장해야 합니다.
  - **요청 본문:**
    ```json
    {
      "items": [
        { "menuId": 1, "quantity": 2, "optionIds": [2] },
        { "menuId": 3, "quantity": 1, "optionIds": [] }
      ],
      "totalPrice": 13000
    }
    ```
  - **응답 (201 CREATED):**
    ```json
    {
      "orderId": 101,
      "status": "주문 접수",
      "createdAt": "2025-10-27T14:30:00Z"
    }
    ```
  - **오류 응답 (400 Bad Request):** 재고 부족 시
    ```json
    { "error": "재고가 부족합니다. (메뉴: 아메리카노(ICE))" }
    ```

- **`GET /api/orders`**
  - **설명:** 관리자 페이지의 '주문 현황'에 표시될 모든 주문 목록을 조회합니다.
  - **쿼리 파라미터:** `?status=주문 접수` 등으로 상태별 필터링이 가능해야 합니다.
  - **응답 (200 OK):**
    ```json
    [
      {
        "id": 101,
        "createdAt": "2025-10-27T14:30:00Z",
        "status": "주문 접수",
        "totalPrice": 13000,
        "items": [
          { "name": "아메리카노(ICE)", "quantity": 2, "options": ["시럽 추가"] }
        ]
      }
    ]
    ```

- **`GET /api/orders/:id`**
  - **설명:** 특정 주문의 상세 정보를 조회합니다.
  - **응답 (200 OK):** 위 `GET /api/orders`의 단일 객체와 동일한 형식.

### 2.3 관리자 API
- **`PATCH /api/orders/:id/status`**
  - **설명:** 관리자가 주문의 상태를 변경합니다. (예: '주문 접수' -> '제조 중')
  - **요청 본문:**
    ```json
    { "status": "제조 중" }
    ```
  - **응답 (200 OK):**
    ```json
    { "orderId": 101, "newStatus": "제조 중" }
    ```

- **`PATCH /api/menus/:id/stock`**
  - **설명:** 관리자가 특정 메뉴의 재고를 수동으로 조절합니다.
  - **요청 본문:**
    ```json
    { "delta": 10 } // 10개 증가
    // 또는 { "stock": 50 } // 재고를 50으로 설정
    ```
  - **응답 (200 OK):**
    ```json
    { "menuId": 1, "newStock": 60 }
    ```

- **`GET /api/admin/summary`**
  - **설명:** 관리자 대시보드에 표시될 요약 정보를 조회합니다.
  - **응답 (200 OK):**
    ```json
    {
      "total": 120,
      "received": 5,
      "inProgress": 8,
      "completed": 107
    }
    ```
